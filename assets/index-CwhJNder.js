var L=Object.defineProperty;var S=(n,e,t)=>e in n?L(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>S(n,typeof e!="symbol"?e+"":e,t);function P(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const y=n=>n.charAt(0).toUpperCase()+n.substring(1),T=Intl.NumberFormat(void 0,{minimumFractionDigits:2,minimumIntegerDigits:2,signDisplay:"always",style:"percent"});function q(n){return"background-position:-".concat(n[0]*12,"px ").concat(n[1]*12,"px;")+(n[2]?"background-image:url('".concat(n[2],"');"):"")}function u(n=Date.now()){return n/36e5}const E=n=>T.format(n),D=(n,e="▲",t="▼",a="—")=>n>0?e:n<0?t:a;function v(n,e){n.textContent!==e&&(n.textContent=e)}function N(n,e,t){n.dataset[e]!==t&&(n.dataset[e]=t)}function M(n,e){const t=document.createElement(n);return e.classList&&(t.className=e.classList.join(" ")),e.classList&&(t.textContent=e.textContent),t}const l=class l{constructor(e,t){f(this,"id");f(this,"angularFrequency");this.id=t,this.angularFrequency=2*Math.PI/e,l.instances.push(this)}static getBestInstance(e,t=u(),a=1){if(!this.instances.length)return;const i=1e-7,r=s=>(s!==this.previousBest&&(this.notifyBestChange(s,this.previousBest),this.previousBest=s),s),c=this.instances.map(s=>{const h=s.getCurrentEffect(t),g=s.getAverageEffect(a,t);return{instance:s,currentEffect:h,averageEffect:g,isActive:s===e}}).filter(s=>s.currentEffect>=0);if(!c.length)return;if(e){const s=c.find(g=>g.isActive),h=Math.max(...c.map(g=>g.currentEffect));if(s!=null&&s.currentEffect&&s.currentEffect>=h)return r(s.instance)}let d=c[0];for(const s of c)(s.averageEffect>d.averageEffect||Math.abs(s.averageEffect-d.averageEffect)<i&&s.currentEffect>d.currentEffect)&&(d=s);return r(d.averageEffect>0?d.instance:void 0)}static getRankedInstances(e,t=u(),a=1){const i=this.instances.map(r=>{const c=r.getCurrentEffect(t),d=r.getAverageEffect(a,t),s=r.getEffectTrend(t),h=r===e;let g=c*1e3+d*100;return{instance:r,currentEffect:c,averageEffect:d,effectTrend:s,isActive:h,score:g,weight:0}});return i.push({instance:{id:"none"},currentEffect:0,averageEffect:0,effectTrend:0,isActive:!e,score:0,weight:0}),i.sort((r,c)=>c.score!==r.score?c.score-r.score:c.averageEffect!==r.averageEffect?c.averageEffect-r.averageEffect:c.effectTrend-r.effectTrend),i.forEach((r,c)=>{r.weight=i.length-1-c}),i.reduce((r,c)=>(r[c.instance.id]={weight:c.weight,current_effect:c.currentEffect,average_effect:c.averageEffect,trend:c.effectTrend,is_active:c.isActive,score:c.score},r),{})}getSlope(e){return Math.cos(this.angularFrequency*e)}getCurrentEffect(e=u(Date.now())){return Math.sin(this.angularFrequency*e)*l.effectMagnitude}getAverageEffect(e=1,t=u(Date.now()),a=this.getSlope(t)){const i=t+e,r=this.getSlope(i)-a;return-l.effectMagnitude/this.angularFrequency*r/e}getEffectTrend(e=u(Date.now()),t=this.getSlope(e)){return Math.sign(t)}getEffectSnapshot({current:e,averageTimeWindow:t,trend:a},i=u(Date.now())){let r,c,d;const s=this.getSlope(i);return e&&(r=this.getCurrentEffect(i)),t&&(c=this.getAverageEffect(t,i,s)),a&&(d=this.getEffectTrend(i,s)),{currentEffect:r,averageEffect:c,effectTrend:d}}static sendNotification(e,t){const[a,i,r,c]=[y((t==null?void 0:t.id)||"none"),y((e==null?void 0:e.id)||"none"),E((e==null?void 0:e.getCurrentEffect())||0),E((e==null?void 0:e.getAverageEffect())||0)];new Notification("".concat(a," -> ").concat(i),{body:"Current Effect: ".concat(r,"\nAverage Effect: ").concat(c),icon:"./cyclius.webp"})}static notifyBestChange(e,t){const a=Date.now();a-this.lastNotificationTime<5e3||performance.now()<5e3||(this.lastNotificationTime=a,Notification.permission==="granted"&&document.visibilityState==="hidden"?this.sendNotification(e,t):Notification.requestPermission().then(i=>{i==="granted"&&document.visibilityState==="hidden"&&this.sendNotification(e,t)}))}static requestNotificationPermission(){Notification.permission!=="granted"&&Notification.requestPermission()}};f(l,"instances",[]),f(l,"previousBest"),f(l,"effectMagnitude",.15),f(l,"lastNotificationTime",0);let m=l;const o=class o{constructor(e,t,a){f(this,"gemCycle");f(this,"class");f(this,"placeholder");f(this,"el");this.gemCycle=new m(e,t),o.instances.push(this),this.class=this.constructor,this.el=this.createCardElement(y(this.gemCycle.id),a),this.updateElement(),this.element.addEventListener("click",()=>this.handleClick())}static setupDom(e=document.body){e.appendChild(this.socket),e.appendChild(this.cardContainer),this.instances.forEach(t=>{this.cardContainer.appendChild(t.element)})}static updateElements(e=u()){const t=o.getBestInstance(o.active,e);this.instances.forEach(a=>a.updateElement(e,t))}handleClick(){try{const e=this.class.active;if(e===this){this.restoreCard(),this.class.socket.innerHTML="",this.class.active=void 0;return}e&&(e.restoreCard(),e.element.dataset.active="false");const t=this.makePlaceholder();this.class.cardContainer.replaceChild(t,this.element),this.class.socket.innerHTML="",this.class.socket.appendChild(this.element),this.class.active=this,this.element.dataset.active="true"}catch(e){console.error("handleClick crash:",e)}}makePlaceholder(){const e=document.createElement("div"),t=this.element.getBoundingClientRect();return e.style.width="".concat(t.width,"px"),e.style.height="".concat(t.height,"px"),e.className="card-placeholder",this.placeholder=e,e}restoreCard(){!this.placeholder||!this.placeholder.parentNode||(this.class.cardContainer.replaceChild(this.element,this.placeholder),this.placeholder=void 0)}get element(){return this.el}updateElement(e=u(),t=o.getBestInstance(o.active,e)){const{currentEffect:a,averageEffect:i,effectTrend:r}=this.gemCycle.getEffectSnapshot({current:!0,averageTimeWindow:1,trend:!0},e);if(a===void 0||i===void 0||r===void 0)return;const c=t&&t===this?"best":a>0?"positive":"negative";this.element.dataset.state=c;const d=this.el.querySelector('[data-part="value"]'),s=this.el.querySelector('[data-part="average"]'),h=this.el.querySelector('[data-part="trend"]');N(h,"trend",r.toString()),N(s,"state",i>0?"positive":"negative"),v(d,E(a)),v(s,E(i)),v(h,D(r))}destroy(){this===o.active&&(o.socket.innerHTML="",o.active=void 0),this.el.remove(),o.instances=o.instances.filter(e=>e!==this)}createCardElement(e,t){const a=document.createElement("button");return a.className="card",a.innerHTML=' \n      <div class="card-header">\n        '.concat(t?'<div class="card-icon" style="'.concat(q(t),'"></div>'):"",'\n        <span class="card-title">').concat(e,'</span>\n        <span class="card-status" data-part="trend"></span>\n      </div>\n      <span class="card-value" data-part="value"></span>\n      <div class="card-footer">\n        <span class="card-average-label">1h</span>\n        <span class="card-average" data-part="average"></span>\n      </div>\n    '),a}static getBestInstance(e,t=u(),a=1){const i=m.getBestInstance(e==null?void 0:e.gemCycle,t,a);return this.instances.find(r=>r.gemCycle===i)}};f(o,"instances",[]),f(o,"active"),f(o,"cardContainer",document.createElement("div")),f(o,"socket",document.createElement("div")),o.socket.className="card-socket",o.cardContainer.className="card-container";let p=o;const A="data:image/webp;base64,UklGRj4CAABXRUJQVlA4TDECAAAvL8AFEAfBprb2Jl96MRABmTKFJpYNJZhAAIe1b73aYBvZtpL7/8fdUg9pwRunCzKGBiBzB7aRbSt587P/cYeIIfYWvABqoDNqIqMEdweDbCMV7ZAO8RDe6AMA//+/VDEAptIrq80KkgSAAXCH37RNRvAqXU35ItPyB+yQcHamFGr8z60wsMxW9yvWtJrtFTtFwSG9oygk5L5C6ag7p1LVWrxVgARJkqRGopkCNjWNLnSkKlXS/P+Z0M3q+EBE/xm4bdtIjs/J7fWKZlY/q/mk+pRzKqqvNaxgBpDkGm3OMaai2uP1ep2mY6oxoyIrZydXfM+6pf1S7WXadN01HSuMEVK4FNlZetm636dZw8zmOPfXaagtEQDoikCZ420f9/1tzDNTN103x67ESBdAkADlGQWhfY69ouJynbrrUFhBUA4nCUY4lmEclyHnNLO9bKfpuKkIAWaivLiOqjiMuuV77puZdOm6zbRgcIFKMropifDwssYYc26Ll76dF5fLcShmEeHJKAtPZaycZHHzU+tfMdPNfwMU4teNWKhvr/m/DA7CDMYwmIGg0LwhY0BBdyjgzhyIXNH3r6HiIvbHLHiYQ1HSPqJ/hacHBcmexbECJavIr0HBBbjBAREKWulTej1cDgAuhxR1ntNr8UcnXIoIObiaM/FaWQThpBdbuZKPtMSLrYIApVDt3Wl3PkeK4bV60hUeclZu2rR7PE6nSC/R2Nw8CZJWeP1nffn3qtR8Sw0A";new p(3,"diamond",[0,0,A]);new p(12,"ruby",[2,0,A]);new p(24,"jade",[0,2,A]);function b(){const n=document.getElementById("app")||document.body;n&&(n.appendChild(M("h1",{textContent:"Chronosight",classList:["header"]})),p.setupDom(n))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b();function C(){try{p.updateElements()}catch(n){console.error("UpdateElements crash:",n)}typeof requestAnimationFrame=="function"?requestAnimationFrame(C):setTimeout(C,100)}C();try{"Notification"in window&&m.requestNotificationPermission()}catch(n){document.body.prepend(M("h1",{textContent:String(n),classList:["error"]}))}export{P as __vite_legacy_guard};
