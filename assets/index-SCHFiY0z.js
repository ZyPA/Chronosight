var M=Object.defineProperty;var w=(n,e,s)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var o=(n,e,s)=>w(n,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(i){if(i.ep)return;i.ep=!0;const t=s(i);fetch(i.href,t)}})();const D=n=>n.charAt(0).toUpperCase()+n.substring(1),q=Intl.NumberFormat(void 0,{minimumFractionDigits:2,minimumIntegerDigits:2,signDisplay:"always",style:"percent"});function S(n){return`background-position:-${n[0]*12}px ${n[1]*12}px;`+(n[2]?`background-image:url('${n[2]}');`:"")}function d(n=Date.now()){return n/36e5}const p=n=>q.format(n),k=(n,e="▲",s="▼",c="—")=>n>0?e:n<0?s:c;function C(n,e){n.textContent!==e&&(n.textContent=e)}function B(n,e,s){n.dataset[e]!==s&&(n.dataset[e]=s)}const u=class u{constructor(e,s){o(this,"id");o(this,"angularFrequency");o(this,"class");this.id=s,this.angularFrequency=2*Math.PI/e,this.class=this.constructor,u.instances.push(this)}static getBestInstance(e,s=d(),c=1){if(!this.instances.length)return;const i=1e-7;let t,a=0,f=0;for(const v of this.instances){const y=v===e,g=v.getCurrentEffect(s),E=v.getAverageEffect(c,s);if(!(y?g>0:g>=0&&E>=0))continue;if(!t){t=v,a=g,f=E;continue}(y!==(t===e)?y:y?g>a||g===a&&E>f:E>f)&&(t=v,a=g,f=E)}const l=t===e,m=f>i;return t&&t!==this.previousBest&&(this.previousBest=t,this.notifyBestChange(t)),t&&(l||m)?t:void 0}static getRankedInstances(e,s=d(),c=1){const i=this.instances.map(t=>{const a=t.getCurrentEffect(s),f=t.getAverageEffect(c,s),l=t.getEffectTrend(s);return{instance:t,currentEffect:a,averageEffect:f,effectTrend:l,isActive:t===e,rankWeight:0}});return i.sort((t,a)=>t.isActive!==a.isActive?t.isActive?-1:1:t.isActive&&a.currentEffect!==t.currentEffect?a.currentEffect-t.currentEffect:a.averageEffect-t.averageEffect),i.forEach((t,a)=>{t.rankWeight=i.length-1-a}),i.reduce((t,a)=>(t[a.instance.id]={weight:a.rankWeight,current_effect:a.currentEffect,average_effect:a.averageEffect,trend:a.effectTrend},t),{})}getSlope(e){return Math.cos(this.angularFrequency*e)}getCurrentEffect(e=d(Date.now())){return Math.sin(this.angularFrequency*e)*this.class.effectMagnitude}getAverageEffect(e=1,s=d(Date.now()),c=this.getSlope(s)){const i=s+e,t=this.getSlope(i)-c;return-this.class.effectMagnitude/this.angularFrequency*t/e}getEffectTrend(e=d(Date.now()),s=this.getSlope(e)){return Math.sign(s)}getEffectSnapshot({current:e,averageTimeWindow:s,trend:c},i=d(Date.now())){let t,a,f;const l=this.getSlope(i);return e&&(t=this.getCurrentEffect(i)),s&&(a=this.getAverageEffect(s,i,l)),c&&(f=this.getEffectTrend(i,l)),{currentEffect:t,averageEffect:a,effectTrend:f}}static notifyBestChange(e){const s=Date.now();s-this.lastNotificationTime<5e3||(this.lastNotificationTime=s,Notification.permission==="granted"&&document.visibilityState==="hidden"?new Notification(`New Best: ${e.id}`,{body:`Current Effect: ${p(e.getCurrentEffect())} | Average Effect: ${p(e.getAverageEffect())}`,icon:"./cyclius.webp"}):Notification.requestPermission().then(c=>{c==="granted"&&document.visibilityState==="hidden"&&new Notification(`New Best: ${e.id}`,{body:`Current Effect: ${p(e.getCurrentEffect())} | Average Effect: ${p(e.getAverageEffect())}`,icon:"./cyclius.webp"})}))}static requestNotificationPermission(){Notification.permission!=="granted"&&Notification.requestPermission()}};o(u,"instances",[]),o(u,"previousBest"),o(u,"effectMagnitude",.15),o(u,"lastNotificationTime",0);let A=u;const r=class r{constructor(e,s,c){o(this,"gemCycle");o(this,"class");o(this,"placeholder");o(this,"el");this.gemCycle=new A(e,s),r.instances.push(this),this.class=this.constructor,this.el=this.createCardElement(D(this.gemCycle.id),c),this.updateElement(),this.element.addEventListener("click",()=>this.handleClick())}static setupDom(e=document.body){e.appendChild(this.socket),e.appendChild(this.cardContainer),this.instances.forEach(s=>{this.cardContainer.appendChild(s.element)})}static updateElements(e=d()){const s=r.getBestInstance(r.active,e);this.instances.forEach(c=>c.updateElement(e,s))}handleClick(){const e=this.class.active;if(e&&e===this){this.restoreCard(),this.class.socket.innerHTML="",this.class.active=void 0;return}e&&(e.restoreCard(),e.element.dataset.active="false");const s=this.makePlaceholder();this.class.cardContainer.replaceChild(s,this.element),this.class.socket.innerHTML="",this.class.socket.appendChild(this.element),this.class.active=this,this.element.dataset.active="true"}makePlaceholder(){const e=document.createElement("div"),s=this.element.getBoundingClientRect();return e.style.width=`${s.width}px`,e.style.height=`${s.height}px`,e.className="card-placeholder",this.placeholder=e,e}restoreCard(){this.placeholder&&this.class.cardContainer.replaceChild(this.element,this.placeholder)}get element(){return this.el}updateElement(e=d(),s=r.getBestInstance(r.active,e)){const{currentEffect:c,averageEffect:i,effectTrend:t}=this.gemCycle.getEffectSnapshot({current:!0,averageTimeWindow:1,trend:!0},e);if(!(c&&i&&t))return;const a=s&&s===this?"best":c>0?"positive":"negative";this.element.dataset.state=a;const f=this.el.querySelector('[data-part="value"]'),l=this.el.querySelector('[data-part="average"]'),m=this.el.querySelector('[data-part="trend"]');B(m,"trend",t.toString()),B(l,"state",i>0?"positive":"negative"),C(f,p(c)),C(l,p(i)),C(m,k(t))}destroy(){this===r.active&&(r.socket.innerHTML="",r.active=void 0),this.el.remove(),r.instances=r.instances.filter(e=>e!==this)}createCardElement(e,s){const c=document.createElement("button");return c.className="card",c.innerHTML=` 
      <div class="card-header">
        ${s?`<div class="card-icon" style="${S(s)}"></div>`:""}
        <span class="card-title">${e}</span>
        <span class="card-status" data-part="trend"></span>
      </div>
      <span class="card-value" data-part="value"></span>
      <div class="card-footer">
        <span class="card-average-label">1h</span>
        <span class="card-average" data-part="average"></span>
      </div>
    `,c}static getBestInstance(e,s=d(),c=1){const i=A.getBestInstance(e==null?void 0:e.gemCycle,s,c);return this.instances.find(t=>t.gemCycle===i)}};o(r,"instances",[]),o(r,"active"),o(r,"cardContainer",document.createElement("div")),o(r,"socket",document.createElement("div")),r.socket.className="card-socket",r.cardContainer.className="card-container";let h=r;const b="data:image/webp;base64,UklGRj4CAABXRUJQVlA4TDECAAAvL8AFEAfBprb2Jl96MRABmTKFJpYNJZhAAIe1b73aYBvZtpL7/8fdUg9pwRunCzKGBiBzB7aRbSt587P/cYeIIfYWvABqoDNqIqMEdweDbCMV7ZAO8RDe6AMA//+/VDEAptIrq80KkgSAAXCH37RNRvAqXU35ItPyB+yQcHamFGr8z60wsMxW9yvWtJrtFTtFwSG9oygk5L5C6ag7p1LVWrxVgARJkqRGopkCNjWNLnSkKlXS/P+Z0M3q+EBE/xm4bdtIjs/J7fWKZlY/q/mk+pRzKqqvNaxgBpDkGm3OMaai2uP1ep2mY6oxoyIrZydXfM+6pf1S7WXadN01HSuMEVK4FNlZetm636dZw8zmOPfXaagtEQDoikCZ420f9/1tzDNTN103x67ESBdAkADlGQWhfY69ouJynbrrUFhBUA4nCUY4lmEclyHnNLO9bKfpuKkIAWaivLiOqjiMuuV77puZdOm6zbRgcIFKMropifDwssYYc26Ll76dF5fLcShmEeHJKAtPZaycZHHzU+tfMdPNfwMU4teNWKhvr/m/DA7CDMYwmIGg0LwhY0BBdyjgzhyIXNH3r6HiIvbHLHiYQ1HSPqJ/hacHBcmexbECJavIr0HBBbjBAREKWulTej1cDgAuhxR1ntNr8UcnXIoIObiaM/FaWQThpBdbuZKPtMSLrYIApVDt3Wl3PkeK4bV60hUeclZu2rR7PE6nSC/R2Nw8CZJWeP1nffn3qtR8Sw0A";new h(3,"diamond",[0,0,b]);new h(12,"ruby",[2,0,b]);new h(24,"jade",[0,2,b]);document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("app")||document.body;if(console.log("Mount point mount is:",n),!n){console.error("❌ No mount point! The DOM isn’t ready or ‘app’ doesn’t exist.");return}const e=document.createElement("h1");e.className="header",e.textContent="Chronosight",n.appendChild(e),h.setupDom(n)});function N(){if(h.updateElements(),typeof requestAnimationFrame=="function")return requestAnimationFrame(N);setTimeout(N,100)}N();try{"Notification"in window&&A.requestNotificationPermission()}catch{alert("Notifications aren't working.")}
