var k=Object.defineProperty;var T=(n,e,t)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>T(n,typeof e!="symbol"?e+"":e,t);function K(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const b=n=>n.charAt(0).toUpperCase()+n.substring(1),P=Intl.NumberFormat(void 0,{minimumFractionDigits:2,minimumIntegerDigits:2,signDisplay:"always",style:"percent"});function x(n){return"background-position:-".concat(n[0]*12,"px ").concat(n[1]*12,"px;")+(n[2]?"background-image:url('".concat(n[2],"');"):"")}function d(n=Date.now()){return n/36e5}const C=n=>P.format(n),R=(n,e="▲",t="▼",c="—")=>n>0?e:n<0?t:c;function N(n,e){n.textContent!==e&&(n.textContent=e)}function L(n,e,t){n.dataset[e]!==t&&(n.dataset[e]=t)}function D(n,e){const t=document.createElement(n);return e.classList&&(t.className=e.classList.join(" ")),e.classList&&(t.textContent=e.textContent),t}const h=class h{constructor(e,t){o(this,"id");o(this,"angularFrequency");o(this,"class");this.id=t,this.angularFrequency=2*Math.PI/e,this.class=this.constructor,h.instances.push(this)}static getBestInstance(e,t=d(),c=1){if(!this.instances.length)return;const s=1e-7;let i,a=0,l=0;for(const m of this.instances){const y=m===e,g=m.getCurrentEffect(t),v=m.getAverageEffect(c,t);if(!(y?g>0:g>=0&&v>=0))continue;if(!i){i=m,a=g,l=v;continue}(y!==(i===e)?y:y?g>a||g===a&&v>l:v>l)&&(i=m,a=g,l=v)}const f=i===e,p=l>s,A=i&&(f||p)?i:void 0;return A!==this.previousBest&&(this.notifyBestChange(A,this.previousBest),this.previousBest=A),A}static getRankedInstances(e,t=d(),c=1){const s=this.instances.map(i=>{const a=i.getCurrentEffect(t),l=i.getAverageEffect(c,t),f=i.getEffectTrend(t);return{instance:i,currentEffect:a,averageEffect:l,effectTrend:f,isActive:i===e,rankWeight:0}});return s.sort((i,a)=>i.isActive!==a.isActive?i.isActive?-1:1:i.isActive&&a.currentEffect!==i.currentEffect?a.currentEffect-i.currentEffect:a.averageEffect-i.averageEffect),s.forEach((i,a)=>{i.rankWeight=s.length-1-a}),s.reduce((i,a)=>(i[a.instance.id]={weight:a.rankWeight,current_effect:a.currentEffect,average_effect:a.averageEffect,trend:a.effectTrend},i),{})}getSlope(e){return Math.cos(this.angularFrequency*e)}getCurrentEffect(e=d(Date.now())){return Math.sin(this.angularFrequency*e)*this.class.effectMagnitude}getAverageEffect(e=1,t=d(Date.now()),c=this.getSlope(t)){const s=t+e,i=this.getSlope(s)-c;return-this.class.effectMagnitude/this.angularFrequency*i/e}getEffectTrend(e=d(Date.now()),t=this.getSlope(e)){return Math.sign(t)}getEffectSnapshot({current:e,averageTimeWindow:t,trend:c},s=d(Date.now())){let i,a,l;const f=this.getSlope(s);return e&&(i=this.getCurrentEffect(s)),t&&(a=this.getAverageEffect(t,s,f)),c&&(l=this.getEffectTrend(s,f)),{currentEffect:i,averageEffect:a,effectTrend:l}}static sendNotification(e,t){const[c,s,i,a]=[b((t==null?void 0:t.id)||"none"),b((e==null?void 0:e.id)||"none"),C((e==null?void 0:e.getCurrentEffect())||0),C((e==null?void 0:e.getAverageEffect())||0)];new Notification("".concat(c," -> ").concat(s),{body:"Current Effect: ".concat(i,"\nAverage Effect: ").concat(a),icon:"./cyclius.webp"})}static notifyBestChange(e,t){const c=Date.now();c-this.lastNotificationTime<5e3||performance.now()<100||(this.lastNotificationTime=c,Notification.permission==="granted"&&document.visibilityState==="hidden"?this.sendNotification(e,t):Notification.requestPermission().then(s=>{s==="granted"&&document.visibilityState==="hidden"&&this.sendNotification(e,t)}))}static requestNotificationPermission(){Notification.permission!=="granted"&&Notification.requestPermission()}};o(h,"instances",[]),o(h,"previousBest"),o(h,"effectMagnitude",.15),o(h,"lastNotificationTime",0);let E=h;const r=class r{constructor(e,t,c){o(this,"gemCycle");o(this,"class");o(this,"placeholder");o(this,"el");this.gemCycle=new E(e,t),r.instances.push(this),this.class=this.constructor,this.el=this.createCardElement(b(this.gemCycle.id),c),this.updateElement(),this.element.addEventListener("click",()=>this.handleClick())}static setupDom(e=document.body){e.appendChild(this.socket),e.appendChild(this.cardContainer),this.instances.forEach(t=>{this.cardContainer.appendChild(t.element)})}static updateElements(e=d()){const t=r.getBestInstance(r.active,e);this.instances.forEach(c=>c.updateElement(e,t))}handleClick(){try{const e=this.class.active;if(e===this){this.restoreCard(),this.class.socket.innerHTML="",this.class.active=void 0;return}e&&(e.restoreCard(),e.element.dataset.active="false");const t=this.makePlaceholder();this.class.cardContainer.replaceChild(t,this.element),this.class.socket.innerHTML="",this.class.socket.appendChild(this.element),this.class.active=this,this.element.dataset.active="true"}catch(e){console.error("handleClick crash:",e)}}makePlaceholder(){const e=document.createElement("div"),t=this.element.getBoundingClientRect();return e.style.width="".concat(t.width,"px"),e.style.height="".concat(t.height,"px"),e.className="card-placeholder",this.placeholder=e,e}restoreCard(){!this.placeholder||!this.placeholder.parentNode||(this.class.cardContainer.replaceChild(this.element,this.placeholder),this.placeholder=void 0)}get element(){return this.el}updateElement(e=d(),t=r.getBestInstance(r.active,e)){const{currentEffect:c,averageEffect:s,effectTrend:i}=this.gemCycle.getEffectSnapshot({current:!0,averageTimeWindow:1,trend:!0},e);if(c===void 0||s===void 0||i===void 0)return;const a=t&&t===this?"best":c>0?"positive":"negative";this.element.dataset.state=a;const l=this.el.querySelector('[data-part="value"]'),f=this.el.querySelector('[data-part="average"]'),p=this.el.querySelector('[data-part="trend"]');L(p,"trend",i.toString()),L(f,"state",s>0?"positive":"negative"),N(l,C(c)),N(f,C(s)),N(p,R(i))}destroy(){this===r.active&&(r.socket.innerHTML="",r.active=void 0),this.el.remove(),r.instances=r.instances.filter(e=>e!==this)}createCardElement(e,t){const c=document.createElement("button");return c.className="card",c.innerHTML=' \n      <div class="card-header">\n        '.concat(t?'<div class="card-icon" style="'.concat(x(t),'"></div>'):"",'\n        <span class="card-title">').concat(e,'</span>\n        <span class="card-status" data-part="trend"></span>\n      </div>\n      <span class="card-value" data-part="value"></span>\n      <div class="card-footer">\n        <span class="card-average-label">1h</span>\n        <span class="card-average" data-part="average"></span>\n      </div>\n    '),c}static getBestInstance(e,t=d(),c=1){const s=E.getBestInstance(e==null?void 0:e.gemCycle,t,c);return this.instances.find(i=>i.gemCycle===s)}};o(r,"instances",[]),o(r,"active"),o(r,"cardContainer",document.createElement("div")),o(r,"socket",document.createElement("div")),r.socket.className="card-socket",r.cardContainer.className="card-container";let u=r;const S="data:image/webp;base64,UklGRj4CAABXRUJQVlA4TDECAAAvL8AFEAfBprb2Jl96MRABmTKFJpYNJZhAAIe1b73aYBvZtpL7/8fdUg9pwRunCzKGBiBzB7aRbSt587P/cYeIIfYWvABqoDNqIqMEdweDbCMV7ZAO8RDe6AMA//+/VDEAptIrq80KkgSAAXCH37RNRvAqXU35ItPyB+yQcHamFGr8z60wsMxW9yvWtJrtFTtFwSG9oygk5L5C6ag7p1LVWrxVgARJkqRGopkCNjWNLnSkKlXS/P+Z0M3q+EBE/xm4bdtIjs/J7fWKZlY/q/mk+pRzKqqvNaxgBpDkGm3OMaai2uP1ep2mY6oxoyIrZydXfM+6pf1S7WXadN01HSuMEVK4FNlZetm636dZw8zmOPfXaagtEQDoikCZ420f9/1tzDNTN103x67ESBdAkADlGQWhfY69ouJynbrrUFhBUA4nCUY4lmEclyHnNLO9bKfpuKkIAWaivLiOqjiMuuV77puZdOm6zbRgcIFKMropifDwssYYc26Ll76dF5fLcShmEeHJKAtPZaycZHHzU+tfMdPNfwMU4teNWKhvr/m/DA7CDMYwmIGg0LwhY0BBdyjgzhyIXNH3r6HiIvbHLHiYQ1HSPqJ/hacHBcmexbECJavIr0HBBbjBAREKWulTej1cDgAuhxR1ntNr8UcnXIoIObiaM/FaWQThpBdbuZKPtMSLrYIApVDt3Wl3PkeK4bV60hUeclZu2rR7PE6nSC/R2Nw8CZJWeP1nffn3qtR8Sw0A";new u(3,"diamond",[0,0,S]);new u(12,"ruby",[2,0,S]);new u(24,"jade",[0,2,S]);function q(){const n=document.getElementById("app")||document.body;n&&(n.appendChild(D("h1",{textContent:"Chronosight",classList:["header"]})),u.setupDom(n))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",q):q();function M(){try{u.updateElements()}catch(n){console.error("UpdateElements crash:",n)}typeof requestAnimationFrame=="function"?requestAnimationFrame(M):setTimeout(M,100)}M();try{"Notification"in window&&E.requestNotificationPermission()}catch(n){document.body.prepend(D("h1",{textContent:String(n),classList:["error"]}))}export{K as __vite_legacy_guard};
