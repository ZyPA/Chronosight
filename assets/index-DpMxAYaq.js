var M=Object.defineProperty;var S=(n,e,i)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var o=(n,e,i)=>S(n,typeof e!="symbol"?e+"":e,i);function x(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(s){if(s.ep)return;s.ep=!0;const t=i(s);fetch(s.href,t)}})();const k=n=>n.charAt(0).toUpperCase()+n.substring(1),q=Intl.NumberFormat(void 0,{minimumFractionDigits:2,minimumIntegerDigits:2,signDisplay:"always",style:"percent"});function D(n){return"background-position:-".concat(n[0]*12,"px ").concat(n[1]*12,"px;")+(n[2]?"background-image:url('".concat(n[2],"');"):"")}function d(n=Date.now()){return n/36e5}const p=n=>q.format(n),T=(n,e="▲",i="▼",a="—")=>n>0?e:n<0?i:a;function C(n,e){n.textContent!==e&&(n.textContent=e)}function B(n,e,i){n.dataset[e]!==i&&(n.dataset[e]=i)}const u=class u{constructor(e,i){o(this,"id");o(this,"angularFrequency");o(this,"class");this.id=i,this.angularFrequency=2*Math.PI/e,this.class=this.constructor,u.instances.push(this)}static getBestInstance(e,i=d(),a=1){if(!this.instances.length)return;const s=1e-7;let t,r=0,l=0;for(const m of this.instances){const y=m===e,g=m.getCurrentEffect(i),E=m.getAverageEffect(a,i);if(!(y?g>0:g>=0&&E>=0))continue;if(!t){t=m,r=g,l=E;continue}(y!==(t===e)?y:y?g>r||g===r&&E>l:E>l)&&(t=m,r=g,l=E)}const f=t===e,v=l>s;return t&&t!==this.previousBest&&(this.previousBest=t,this.notifyBestChange(t)),t&&(f||v)?t:void 0}static getRankedInstances(e,i=d(),a=1){const s=this.instances.map(t=>{const r=t.getCurrentEffect(i),l=t.getAverageEffect(a,i),f=t.getEffectTrend(i);return{instance:t,currentEffect:r,averageEffect:l,effectTrend:f,isActive:t===e,rankWeight:0}});return s.sort((t,r)=>t.isActive!==r.isActive?t.isActive?-1:1:t.isActive&&r.currentEffect!==t.currentEffect?r.currentEffect-t.currentEffect:r.averageEffect-t.averageEffect),s.forEach((t,r)=>{t.rankWeight=s.length-1-r}),s.reduce((t,r)=>(t[r.instance.id]={weight:r.rankWeight,current_effect:r.currentEffect,average_effect:r.averageEffect,trend:r.effectTrend},t),{})}getSlope(e){return Math.cos(this.angularFrequency*e)}getCurrentEffect(e=d(Date.now())){return Math.sin(this.angularFrequency*e)*this.class.effectMagnitude}getAverageEffect(e=1,i=d(Date.now()),a=this.getSlope(i)){const s=i+e,t=this.getSlope(s)-a;return-this.class.effectMagnitude/this.angularFrequency*t/e}getEffectTrend(e=d(Date.now()),i=this.getSlope(e)){return Math.sign(i)}getEffectSnapshot({current:e,averageTimeWindow:i,trend:a},s=d(Date.now())){let t,r,l;const f=this.getSlope(s);return e&&(t=this.getCurrentEffect(s)),i&&(r=this.getAverageEffect(i,s,f)),a&&(l=this.getEffectTrend(s,f)),{currentEffect:t,averageEffect:r,effectTrend:l}}static notifyBestChange(e){const i=Date.now();i-this.lastNotificationTime<5e3||(this.lastNotificationTime=i,Notification.permission==="granted"&&document.visibilityState==="hidden"?new Notification("New Best: ".concat(e.id),{body:"Current Effect: ".concat(p(e.getCurrentEffect())," | Average Effect: ").concat(p(e.getAverageEffect())),icon:"./cyclius.webp"}):Notification.requestPermission().then(a=>{a==="granted"&&document.visibilityState==="hidden"&&new Notification("New Best: ".concat(e.id),{body:"Current Effect: ".concat(p(e.getCurrentEffect())," | Average Effect: ").concat(p(e.getAverageEffect())),icon:"./cyclius.webp"})}))}static requestNotificationPermission(){Notification.permission!=="granted"&&Notification.requestPermission()}};o(u,"instances",[]),o(u,"previousBest"),o(u,"effectMagnitude",.15),o(u,"lastNotificationTime",0);let A=u;const c=class c{constructor(e,i,a){o(this,"gemCycle");o(this,"class");o(this,"placeholder");o(this,"el");this.gemCycle=new A(e,i),c.instances.push(this),this.class=this.constructor,this.el=this.createCardElement(k(this.gemCycle.id),a),this.updateElement(),this.element.addEventListener("click",()=>this.handleClick())}static setupDom(e=document.body){e.appendChild(this.socket),e.appendChild(this.cardContainer),this.instances.forEach(i=>{this.cardContainer.appendChild(i.element)})}static updateElements(e=d()){const i=c.getBestInstance(c.active,e);this.instances.forEach(a=>a.updateElement(e,i))}handleClick(){try{const e=this.class.active;if(e===this){this.restoreCard(),this.class.socket.innerHTML="",this.class.active=void 0;return}e&&(e.restoreCard(),e.element.dataset.active="false");const i=this.makePlaceholder();this.class.cardContainer.replaceChild(i,this.element),this.class.socket.innerHTML="",this.class.socket.appendChild(this.element),this.class.active=this,this.element.dataset.active="true"}catch(e){console.error("handleClick crash:",e)}}makePlaceholder(){const e=document.createElement("div"),i=this.element.getBoundingClientRect();return e.style.width="".concat(i.width,"px"),e.style.height="".concat(i.height,"px"),e.className="card-placeholder",this.placeholder=e,e}restoreCard(){!this.placeholder||!this.placeholder.parentNode||(this.class.cardContainer.replaceChild(this.element,this.placeholder),this.placeholder=void 0)}get element(){return this.el}updateElement(e=d(),i=c.getBestInstance(c.active,e)){const{currentEffect:a,averageEffect:s,effectTrend:t}=this.gemCycle.getEffectSnapshot({current:!0,averageTimeWindow:1,trend:!0},e);if(a===void 0||s===void 0||t===void 0)return;const r=i&&i===this?"best":a>0?"positive":"negative";this.element.dataset.state=r;const l=this.el.querySelector('[data-part="value"]'),f=this.el.querySelector('[data-part="average"]'),v=this.el.querySelector('[data-part="trend"]');B(v,"trend",t.toString()),B(f,"state",s>0?"positive":"negative"),C(l,p(a)),C(f,p(s)),C(v,T(t))}destroy(){this===c.active&&(c.socket.innerHTML="",c.active=void 0),this.el.remove(),c.instances=c.instances.filter(e=>e!==this)}createCardElement(e,i){const a=document.createElement("button");return a.className="card",a.innerHTML=' \n      <div class="card-header">\n        '.concat(i?'<div class="card-icon" style="'.concat(D(i),'"></div>'):"",'\n        <span class="card-title">').concat(e,'</span>\n        <span class="card-status" data-part="trend"></span>\n      </div>\n      <span class="card-value" data-part="value"></span>\n      <div class="card-footer">\n        <span class="card-average-label">1h</span>\n        <span class="card-average" data-part="average"></span>\n      </div>\n    '),a}static getBestInstance(e,i=d(),a=1){const s=A.getBestInstance(e==null?void 0:e.gemCycle,i,a);return this.instances.find(t=>t.gemCycle===s)}};o(c,"instances",[]),o(c,"active"),o(c,"cardContainer",document.createElement("div")),o(c,"socket",document.createElement("div")),c.socket.className="card-socket",c.cardContainer.className="card-container";let h=c;const b="data:image/webp;base64,UklGRj4CAABXRUJQVlA4TDECAAAvL8AFEAfBprb2Jl96MRABmTKFJpYNJZhAAIe1b73aYBvZtpL7/8fdUg9pwRunCzKGBiBzB7aRbSt587P/cYeIIfYWvABqoDNqIqMEdweDbCMV7ZAO8RDe6AMA//+/VDEAptIrq80KkgSAAXCH37RNRvAqXU35ItPyB+yQcHamFGr8z60wsMxW9yvWtJrtFTtFwSG9oygk5L5C6ag7p1LVWrxVgARJkqRGopkCNjWNLnSkKlXS/P+Z0M3q+EBE/xm4bdtIjs/J7fWKZlY/q/mk+pRzKqqvNaxgBpDkGm3OMaai2uP1ep2mY6oxoyIrZydXfM+6pf1S7WXadN01HSuMEVK4FNlZetm636dZw8zmOPfXaagtEQDoikCZ420f9/1tzDNTN103x67ESBdAkADlGQWhfY69ouJynbrrUFhBUA4nCUY4lmEclyHnNLO9bKfpuKkIAWaivLiOqjiMuuV77puZdOm6zbRgcIFKMropifDwssYYc26Ll76dF5fLcShmEeHJKAtPZaycZHHzU+tfMdPNfwMU4teNWKhvr/m/DA7CDMYwmIGg0LwhY0BBdyjgzhyIXNH3r6HiIvbHLHiYQ1HSPqJ/hacHBcmexbECJavIr0HBBbjBAREKWulTej1cDgAuhxR1ntNr8UcnXIoIObiaM/FaWQThpBdbuZKPtMSLrYIApVDt3Wl3PkeK4bV60hUeclZu2rR7PE6nSC/R2Nw8CZJWeP1nffn3qtR8Sw0A";new h(3,"diamond",[0,0,b]);new h(12,"ruby",[2,0,b]);new h(24,"jade",[0,2,b]);function w(){const n=document.getElementById("app")||document.body;if(!n)return;const e=document.createElement("h1");e.className="header",e.textContent="Chronosight",n.appendChild(e),h.setupDom(n)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w();function N(){try{h.updateElements()}catch(n){console.error("UpdateElements crash:",n)}typeof requestAnimationFrame=="function"?requestAnimationFrame(N):setTimeout(N,100)}N();try{"Notification"in window&&A.requestNotificationPermission()}catch(n){alert("Notifications aren't working.")}export{x as __vite_legacy_guard};
