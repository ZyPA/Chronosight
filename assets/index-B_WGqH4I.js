var B=Object.defineProperty;var M=(n,e,t)=>e in n?B(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>M(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const w=n=>n.charAt(0).toUpperCase()+n.substring(1),D=Intl.NumberFormat(void 0,{minimumFractionDigits:2,minimumIntegerDigits:2,signDisplay:"always",style:"percent"});function q(n){return`background-position:-${n[0]*12}px ${n[1]*12}px;`+(n[2]?`background-image:url('${n[2]}');`:"")}function d(n=Date.now()){return n/36e5}const p=n=>D.format(n),S=(n,e="▲",t="▼",c="—")=>n>0?e:n<0?t:c;function C(n,e){n.textContent!==e&&(n.textContent=e)}function b(n,e,t){n.dataset[e]!==t&&(n.dataset[e]=t)}const u=class u{constructor(e,t){o(this,"id");o(this,"angularFrequency");o(this,"class");this.id=t,this.angularFrequency=2*Math.PI/e,this.class=this.constructor,u.instances.push(this)}static getBestInstance(e,t=d(),c=1){if(!this.instances.length)return;const i=1e-7;let s,r=0,f=0;for(const v of this.instances){const y=v===e,g=v.getCurrentEffect(t),E=v.getAverageEffect(c,t);if(!(y?g>0:g>=0&&E>=0))continue;if(!s){s=v,r=g,f=E;continue}(y!==(s===e)?y:y?g>r||g===r&&E>f:E>f)&&(s=v,r=g,f=E)}const l=s===e,m=f>i;return s&&s!==this.previousBest&&(this.previousBest=s,this.notifyBestChange(s)),s&&(l||m)?s:void 0}static getRankedInstances(e,t=d(),c=1){const i=this.instances.map(s=>{const r=s.getCurrentEffect(t),f=s.getAverageEffect(c,t),l=s.getEffectTrend(t);return{instance:s,currentEffect:r,averageEffect:f,effectTrend:l,isActive:s===e,rankWeight:0}});return i.sort((s,r)=>s.isActive!==r.isActive?s.isActive?-1:1:s.isActive&&r.currentEffect!==s.currentEffect?r.currentEffect-s.currentEffect:r.averageEffect-s.averageEffect),i.forEach((s,r)=>{s.rankWeight=i.length-1-r}),i.reduce((s,r)=>(s[r.instance.id]={weight:r.rankWeight,current_effect:r.currentEffect,average_effect:r.averageEffect,trend:r.effectTrend},s),{})}getSlope(e){return Math.cos(this.angularFrequency*e)}getCurrentEffect(e=d(Date.now())){return Math.sin(this.angularFrequency*e)*this.class.effectMagnitude}getAverageEffect(e=1,t=d(Date.now()),c=this.getSlope(t)){const i=t+e,s=this.getSlope(i)-c;return-this.class.effectMagnitude/this.angularFrequency*s/e}getEffectTrend(e=d(Date.now()),t=this.getSlope(e)){return Math.sign(t)}getEffectSnapshot({current:e,averageTimeWindow:t,trend:c},i=d(Date.now())){let s,r,f;const l=this.getSlope(i);return e&&(s=this.getCurrentEffect(i)),t&&(r=this.getAverageEffect(t,i,l)),c&&(f=this.getEffectTrend(i,l)),{currentEffect:s,averageEffect:r,effectTrend:f}}static notifyBestChange(e){const t=Date.now();t-this.lastNotificationTime<5e3||(this.lastNotificationTime=t,Notification.permission==="granted"&&document.visibilityState==="hidden"?new Notification(`New Best: ${e.id}`,{body:`Current Effect: ${p(e.getCurrentEffect())} | Average Effect: ${p(e.getAverageEffect())}`,icon:"./cyclius.webp"}):Notification.requestPermission().then(c=>{c==="granted"&&document.visibilityState==="hidden"&&new Notification(`New Best: ${e.id}`,{body:`Current Effect: ${p(e.getCurrentEffect())} | Average Effect: ${p(e.getAverageEffect())}`,icon:"./cyclius.webp"})}))}static requestNotificationPermission(){Notification.permission!=="granted"&&Notification.requestPermission()}};o(u,"instances",[]),o(u,"previousBest"),o(u,"effectMagnitude",.15),o(u,"lastNotificationTime",0);let A=u;const a=class a{constructor(e,t,c){o(this,"gemCycle");o(this,"class");o(this,"placeholder");o(this,"el");this.gemCycle=new A(e,t),a.instances.push(this),this.class=this.constructor,this.el=this.createCardElement(w(this.gemCycle.id),c),this.updateElement(),this.element.addEventListener("click",()=>this.handleClick())}static setupDom(e=document.body){e.appendChild(this.socket),e.appendChild(this.cardContainer),this.instances.forEach(t=>{this.cardContainer.appendChild(t.element)})}static updateElements(e=d()){const t=a.getBestInstance(a.active,e);this.instances.forEach(c=>c.updateElement(e,t))}handleClick(){const e=this.class.active;if(e&&e===this){this.restoreCard(),this.class.socket.innerHTML="",this.class.active=void 0;return}e&&(e.restoreCard(),e.element.dataset.active="false");const t=this.makePlaceholder();this.class.cardContainer.replaceChild(t,this.element),this.class.socket.innerHTML="",this.class.socket.appendChild(this.element),this.class.active=this,this.element.dataset.active="true"}makePlaceholder(){const e=document.createElement("div"),t=this.element.getBoundingClientRect();return e.style.width=`${t.width}px`,e.style.height=`${t.height}px`,e.className="card-placeholder",this.placeholder=e,e}restoreCard(){this.placeholder&&this.class.cardContainer.replaceChild(this.element,this.placeholder)}get element(){return this.el}updateElement(e=d(),t=a.getBestInstance(a.active,e)){const{currentEffect:c,averageEffect:i,effectTrend:s}=this.gemCycle.getEffectSnapshot({current:!0,averageTimeWindow:1,trend:!0},e);if(!(c&&i&&s))return;const r=t&&t===this?"best":c>0?"positive":"negative";this.element.dataset.state=r;const f=this.el.querySelector('[data-part="value"]'),l=this.el.querySelector('[data-part="average"]'),m=this.el.querySelector('[data-part="trend"]');b(m,"trend",s.toString()),b(l,"state",i>0?"positive":"negative"),C(f,p(c)),C(l,p(i)),C(m,S(s))}destroy(){this===a.active&&(a.socket.innerHTML="",a.active=void 0),this.el.remove(),a.instances=a.instances.filter(e=>e!==this)}createCardElement(e,t){const c=document.createElement("button");return c.className="card",c.innerHTML=` 
      <div class="card-header">
        ${t?`<div class="card-icon" style="${q(t)}"></div>`:""}
        <span class="card-title">${e}</span>
        <span class="card-status" data-part="trend"></span>
      </div>
      <span class="card-value" data-part="value"></span>
      <div class="card-footer">
        <span class="card-average-label">1h</span>
        <span class="card-average" data-part="average"></span>
      </div>
    `,c}static getBestInstance(e,t=d(),c=1){const i=A.getBestInstance(e==null?void 0:e.gemCycle,t,c);return this.instances.find(s=>s.gemCycle===i)}};o(a,"instances",[]),o(a,"active"),o(a,"cardContainer",document.createElement("div")),o(a,"socket",document.createElement("div")),a.socket.className="card-socket",a.cardContainer.className="card-container";let h=a;const N="data:image/webp;base64,UklGRj4CAABXRUJQVlA4TDECAAAvL8AFEAfBprb2Jl96MRABmTKFJpYNJZhAAIe1b73aYBvZtpL7/8fdUg9pwRunCzKGBiBzB7aRbSt587P/cYeIIfYWvABqoDNqIqMEdweDbCMV7ZAO8RDe6AMA//+/VDEAptIrq80KkgSAAXCH37RNRvAqXU35ItPyB+yQcHamFGr8z60wsMxW9yvWtJrtFTtFwSG9oygk5L5C6ag7p1LVWrxVgARJkqRGopkCNjWNLnSkKlXS/P+Z0M3q+EBE/xm4bdtIjs/J7fWKZlY/q/mk+pRzKqqvNaxgBpDkGm3OMaai2uP1ep2mY6oxoyIrZydXfM+6pf1S7WXadN01HSuMEVK4FNlZetm636dZw8zmOPfXaagtEQDoikCZ420f9/1tzDNTN103x67ESBdAkADlGQWhfY69ouJynbrrUFhBUA4nCUY4lmEclyHnNLO9bKfpuKkIAWaivLiOqjiMuuV77puZdOm6zbRgcIFKMropifDwssYYc26Ll76dF5fLcShmEeHJKAtPZaycZHHzU+tfMdPNfwMU4teNWKhvr/m/DA7CDMYwmIGg0LwhY0BBdyjgzhyIXNH3r6HiIvbHLHiYQ1HSPqJ/hacHBcmexbECJavIr0HBBbjBAREKWulTej1cDgAuhxR1ntNr8UcnXIoIObiaM/FaWQThpBdbuZKPtMSLrYIApVDt3Wl3PkeK4bV60hUeclZu2rR7PE6nSC/R2Nw8CZJWeP1nffn3qtR8Sw0A";new h(3,"diamond",[0,0,N]);new h(12,"ruby",[2,0,N]);new h(24,"jade",[0,2,N]);document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("app")||document.body;if(console.log("Mount point mount is:",n),!n){console.error("❌ No mount point! The DOM isn’t ready or ‘app’ doesn’t exist.");return}const e=document.createElement("h1");e.className="header",e.textContent="Chronosight",n.appendChild(e),h.setupDom(n);function t(){if(h.updateElements(),typeof requestAnimationFrame=="function")return requestAnimationFrame(t);setTimeout(t,100)}t()});try{"Notification"in window&&A.requestNotificationPermission()}catch{alert("Notifications aren't working.")}
