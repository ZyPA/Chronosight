const root=document.querySelector(".sockets"),container=document.querySelector(".container"),defaultConfig={root};function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function createSocketHTML(e){let t=e.root;if(!t)return;let s=document.createElement("button");s.className="socket",s.id=e.id,s.innerHTML=`<div class="socket-header"><img class="socket-icon" src="assets/${e.id}.webp"/><span class="socket-title">${capitalize(e.id)}</span><span class="socket-status"></span></div><span class="socket-value"></span><div class="socket-footer"><span class="socket-average-label">1h</span><span class="socket-average"></span></div>`,t.appendChild(s)}function createSocketSlot(){let e=document.createElement("div");e.className="socket-slot",e.innerHTML=`<div class="socket-slot-inner empty" id="socket-slot-inner"></div>`,container&&container.insertBefore(e,root)}function moveSocketToSlot(e){let t=document.getElementById("socket-slot-inner"),s=document.querySelector(".sockets");if(!t||!s)return;let a=s.querySelector(".socket-ghost");a&&s.removeChild(a);let o=t.querySelector(".socket");if(o&&(s.appendChild(o),t.classList.add("empty"),cycleConfigs.forEach(e=>{let t=document.getElementById(e.id);t&&t.parentElement===s&&s.appendChild(t)})),e){let i=document.getElementById(e);if(i){t.classList.remove("empty"),t.innerHTML="",t.appendChild(i);let n=document.createElement("div");n.className="socket socket-ghost",n.innerHTML="<div class='socket-header'></div><span class='socket-value'></span><div class='socket-footer'></div>";let c=cycleConfigs.findIndex(t=>t.id===e),l=Array.from(s.querySelectorAll(".socket")),r=l.filter(e=>!e.classList.contains("socket-ghost")&&e.parentElement===s);c>=0&&c<r.length?s.insertBefore(n,r[c]):s.appendChild(n)}}}createSocketSlot();class Cycle{config;k;amp;elements;socketed=!1;lastState={};constructor(e){this.config=e,this.k=2*Math.PI/e.period,this.amp=e.amp??15;let t=document.getElementById(e.id);this.elements={root:t,status:t.querySelector(".socket-status"),value:t.querySelector(".socket-value"),average:t.querySelector(".socket-average")},t.addEventListener("click",()=>this.toggleSocket())}getEffect(e){return Math.sin(this.k*(e/36e5))*this.amp}getAverage1H(e){let t=e/36e5;return-this.amp/this.k*(Math.cos(this.k*(t+1))-Math.cos(this.k*t))}update(e,t=!1){let s=this.getEffect(e),a=this.getEffect(e+1),o=this.getAverage1H(e),i=s>0,n=t?"best":i?"positive":"negative",c=o>0?"positive":"negative",l=s<a?"increasing":"decreasing",r="increasing"===l?"▲":"▼",d=`${i?"+":""}${s.toFixed(2)}%`,u=`${o>0?"+":""}${o.toFixed(2)}%`;this.lastState.state!==n&&(this.elements.root.setAttribute("data-state",n),this.lastState.state=n),this.lastState.avgState!==c&&(this.elements.average.setAttribute("data-state",c),this.lastState.avgState=c),this.lastState.value!==d&&(this.elements.value.textContent=d,this.lastState.value=d),this.lastState.average!==u&&(this.elements.average.textContent=u,this.lastState.average=u),this.lastState.status!==l&&(this.elements.status.setAttribute("data-status",l),this.lastState.status=l),this.lastState.statusSymbol!==r&&(this.elements.status.textContent=r,this.lastState.statusSymbol=r)}toggleSocket(){this.socketed?(this.socketed=!1,onSocketChange(null)):onSocketChange(this.config.id)}setSocketed(e){this.socketed=e}}const cycleConfigs=[{...defaultConfig,id:"diamond",period:3},{...defaultConfig,id:"ruby",period:12},{...defaultConfig,id:"jade",period:24},];cycleConfigs.forEach(createSocketHTML);const cycles=Object.fromEntries(cycleConfigs.map(e=>[e.id,new Cycle(e)]));let socketedKey=null;function onSocketChange(e){for(let[t,s]of(socketedKey=e,Object.entries(cycles)))s.setSocketed(t===socketedKey);moveSocketToSlot(socketedKey)}function getBest(e,t){let s=Object.entries(cycles).map(([t,s])=>{let a=s.getEffect(e),o=s.getAverage1H(e);return a>=0&&o>=0?{key:t,value:a,avg:o}:null}).filter(Boolean);if(!s.length)return"none";let a=s.slice().sort((e,t)=>t.avg-e.avg)[0];if(t){let o=s.find(e=>e.key===t);if(o&&o.value>=a.value)return t}return a.key}function startRenderLoop(){!function e(){let t=Date.now(),s=getBest(t,socketedKey);for(let[a,o]of Object.entries(cycles))o.update(t,a===s);requestAnimationFrame(e)}()}startRenderLoop();